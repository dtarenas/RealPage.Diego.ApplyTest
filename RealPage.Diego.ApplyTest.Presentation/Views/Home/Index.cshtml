@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@{
    ViewData["Title"] = "Home Page";
}

<section>
    <div class="text-center">
        <h1 class="display-4">Welcome</h1>
        <h3>RealPage - Apply Test</h3>
        <h6 class="text-muted">By Diego Arenas Tangarife</h6>
    </div>
</section>
<hr />
<section>
    <div class="container">
        <div class="row">
            <div class="col-12 text-center">
                @if (!string.IsNullOrEmpty(HttpContextAccessor.HttpContext.Session.GetString("Username")))
                {
                    <h4>Select an option.</h4>
                    <h5 class="text-muted">You are Admin</h5>
                    <a class="btn btn-outline-info" href="#" id="tvMazeSectionBtn">Search On TV Maze</a>

                    @if (!string.IsNullOrEmpty(HttpContextAccessor.HttpContext.Session.GetString("Role")) && Encrypt.Base64Decode(HttpContextAccessor.HttpContext.Session.GetString("Role")) == Roles.Admin.ToString())
                    {
                        <a class="btn btn-outline-warning" href="#" onclick="GetElements('Users')">Manage Users</a>
                    }
                }
                else
                {
                    <h4>To see the options, please log in.</h4>
                    <a class="btn btn-outline-dark mx-1" href="#" onclick="ToggleLogin()"><i class="fas fa-user"></i> Log In</a>
                    <a class="btn btn-outline-dark mx-1" href="#" onclick="ToggleRegister()"><i class="fas fa-check"></i> Register</a>
                }
            </div>
        </div>
    </div>
</section>
<section id="tvMazeSection" class="d-none">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <form id="frmTvMazeSearch">
                    <div class="form-row align-items-center">
                        <div class="col-auto">
                            <label class="sr-only" for="inlineFormInputGroup">Search</label>
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="query" name="query" placeholder="Search..." required>
                                <div class="input-group-prepend">
                                    <div class="input-group-text">
                                        <button type="submit" class="btn btn-primary m-0 p-0"><i class="fas fa-search"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

@section Scripts{
    <script>
        const $tvMazeSectionBtn = document.querySelector("#tvMazeSectionBtn");
        const $frmTvMazeSearch = document.querySelector("#frmTvMazeSearch");
        const $tvMazeSection = document.querySelector("#tvMazeSection");

        if ($tvMazeSectionBtn) {
            $tvMazeSectionBtn.addEventListener("click", (e) => {
                if ($tvMazeSection.classList.contains("d-none")) {
                    $tvMazeSection.classList.remove("d-none");
                    $tvMazeSection.classList.add("d-block");
                } else {
                    $tvMazeSection.classList.remove("d-block");
                    $tvMazeSection.classList.add("d-none");
                }
            });
        }

        if ($frmTvMazeSearch) {
            $frmTvMazeSearch.addEventListener("submit", async (e) => {
                debugger;
                e.preventDefault();
                const request = await fetch(`/Search/Index/${e.target["query"].value}`);


                alert("Searching");
            });
        }
    </script>
}